# Master Knowledge Graph Rules & Ontology

## Purpose

This document is the **single authoritative source of truth** for all agents involved in transforming raw CSV FAQ data into a validated Knowledge Graph.

It defines:

* The ontology (entities, attributes, relationships)
* Hard rules that MUST be followed
* Agent-specific responsibilities and constraints

If any agent output conflicts with this document, the output MUST be rejected by the VerificationCritic.

---

## Global Design Principles (Hard Rules)

1. **No Guessing Rule**
   An entity, attribute, or relationship MUST NOT be created unless it is explicitly supported by the source text.

2. **Golden Rule of Evidence**

   > No fact without a verbatim quote.

3. **Determinism Over Coverage**
   It is acceptable to miss information. It is NOT acceptable to invent information.

4. **Ontology-First Extraction**
   Extraction happens only after schema alignment. Free-form extraction is forbidden.

5. **Verification Supremacy**
   The VerificationCritic has veto power over all upstream agents.

---

## Ontology Overview

### Entity Types (14 Total)

Each extracted entity MUST match one of the following types exactly.

* CustomerIntent
* InstructionStep
* Condition
* EvidenceAnchor
* ErrorState
* Requirement
* Outcome
* Constraint
* Tool
* Location
* TimeReference
* Policy
* Exception
* Clarification

Entities outside this list are forbidden.

---

## Entity Definitions & Attribute Rules

### CustomerIntent

**Definition:** A goal or objective the customer is trying to achieve.

**Required Attributes:**

* intent_text (verbatim)
* evidence_anchor

---

### InstructionStep

**Definition:** A concrete action the customer must perform.

**Required Attributes:**

* step_text (verbatim)
* step_order (integer, if explicit)
* evidence_anchor

---

### Condition

**Definition:** A prerequisite or blocker that enables or disables steps or intents.

**Required Attributes:**

* condition_text (verbatim)
* evidence_anchor

---

### EvidenceAnchor

**Definition:** Exact source text proving an extracted fact.

**Rules:**

* Must be a direct substring of the CSV row
* No paraphrasing
* No summarization

---

## Relationship Types & Constraints

All relationships MUST be directional and valid according to this table:

| Relationship | From Entity     | To Entity       | Meaning                    |
| ------------ | --------------- | --------------- | -------------------------- |
| FULFILLS     | InstructionStep | CustomerIntent  | Step contributes to intent |
| NEXT         | InstructionStep | InstructionStep | Sequential ordering        |
| REQUIRES     | CustomerIntent  | Condition       | Condition must be met      |
| BLOCKED_BY   | InstructionStep | Condition       | Step cannot execute        |
| ENABLES      | Condition       | InstructionStep | Condition allows step      |

Invalid or inferred relationships are forbidden.

---

## Agent-Specific Contracts

### 1. SchemaMapper

**Purpose:** Ontology alignment only.

**Responsibilities:**

* Read raw CSV text
* Identify which ontology entities are present
* Output entity types WITHOUT attributes

**Hard Constraints:**

* MUST NOT extract attributes
* MUST NOT infer entity existence
* MUST output entity spans tied to text

---

### 2. EvidenceExtractor

**Purpose:** Attribute extraction with proof.

**Responsibilities:**

* Extract attributes only for entities identified by SchemaMapper
* Attach EvidenceAnchor to every attribute

**Hard Constraints:**

* Paraphrasing is forbidden
* Attributes without evidence MUST be dropped

---

### 3. GraphLinker

**Purpose:** Relationship construction.

**Responsibilities:**

* Analyze entities across rows
* Create valid relationships only

**Hard Constraints:**

* MUST validate against relationship table
* MUST respect conditions and ordering
* MUST NOT create orphan InstructionSteps

---

### 4. VerificationCritic

**Purpose:** Final validation and rejection.

**Responsibilities:**

* Verify verbatim evidence
* Validate schema compliance
* Detect hallucinations or inference

**Rejection Checklist:**

* ❌ Evidence not verbatim
* ❌ Attribute unsupported by text
* ❌ Invalid entity or relationship
* ❌ Paraphrasing detected

VerificationCritic decisions are final.

---

## Failure Handling Protocol

If any agent violates a hard rule:

1. Output is rejected
2. Error is logged with reason
3. No partial graph updates are allowed

---

## Priority of Authority

1. This document
2. Structured schema definitions
3. Agent outputs
4. Vector DB examples (assistive only)

If conflicts occur, higher priority always wins.

---

## Closing Principle

> This Knowledge Graph values **truth over completeness**.
> The system succeeds by being correct, not by being exhaustive.
